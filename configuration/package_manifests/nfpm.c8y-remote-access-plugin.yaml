# yaml-language-server: $schema=https://nfpm.goreleaser.com/static/schema.json
---
name: c8y-remote-access-plugin
description: |
  Thin-edge device log file retriever for Cumulocity
arch: "${PKG_ARCH}"
platform: "linux"
version: "${GIT_SEMVER}"
section: misc
priority: "optional"
maintainer: "thin-edge.io team <info@thin-edge.io>"
vendor: "thin-edge.io"
homepage: "https://thin-edge.io"
license: "Apache-2.0"

deb:
  fields:
    Vcs-Browser: ${CI_PROJECT_URL}
    Vcs-Git: ${CI_PROJECT_URL}
  compression: xz

depends:
  # Requires tedge user to create the supported operation file.
  # The tedge user is created by the tedge package
  # so it must be run before this package's postinst.
  # Debian seems to work without this depends, however the rpm package
  # seems to use another sorting order if the dependency is not defined.
  - tedge

contents:
  # binary
  - src: .build/c8y-remote-access-plugin
    dst: /usr/bin/

overrides:
  apk:
    scripts:
      preinstall: configuration/package_scripts/_generated/c8y-remote-access-plugin/apk/preinst
      postinstall: configuration/package_scripts/_generated/c8y-remote-access-plugin/apk/postinst
      preremove: configuration/package_scripts/_generated/c8y-remote-access-plugin/apk/prerm
      postremove: configuration/package_scripts/_generated/c8y-remote-access-plugin/apk/postrm

  rpm:
    scripts:
      preinstall: configuration/package_scripts/_generated/c8y-remote-access-plugin/rpm/preinst
      postinstall: configuration/package_scripts/_generated/c8y-remote-access-plugin/rpm/postinst
      preremove: configuration/package_scripts/_generated/c8y-remote-access-plugin/rpm/prerm
      postremove: configuration/package_scripts/_generated/c8y-remote-access-plugin/rpm/postrm

  deb:
    scripts:
      preinstall: configuration/package_scripts/_generated/c8y-remote-access-plugin/deb/preinst
      postinstall: configuration/package_scripts/_generated/c8y-remote-access-plugin/deb/postinst
      preremove: configuration/package_scripts/_generated/c8y-remote-access-plugin/deb/prerm
      postremove: configuration/package_scripts/_generated/c8y-remote-access-plugin/deb/postrm